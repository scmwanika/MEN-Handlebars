<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Stock Manager</title>

  <!-- FONT AWESOME -->
  <link data-require="font-awesome@*" data-semver="4.2.0" rel="stylesheet"
    href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/4.2.0/css/font-awesome.css" />

  <!-- CSS -->
  <link rel='stylesheet' , href='https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css' ,
    integrity='sha384-zCbKRCUGaJDkqS1kPbPd7TveP5iyJE0EjAuZQTgFLD2ylzuqKfdKlfG/eSrtxUkn' , crossorigin='anonymous'>

  <style>
    .navbar {
      width: 100%;
      position: fixed;
      top: 0;
    }

    body {
      /* Padding to prevent the content to go underneath the header */
      padding-top: 75px;
      font-family: 'Gill Sans', 'Gill Sans MT', Calibri, 'Trebuchet MS', sans-serif;
      background-color: #ebebed;
    }

    span {
      color: #0000FF;
      font-size: 22pt;
      font-weight: lighter;
      font-family: Monotype Corsiva;
    }

    p {
      color: #0000FF;
      font-size: 14pt;
      font-family: 'Courier New', Courier, monospace
    }

    .dropdown-menu {
      border: none;
    }

    a,
    label {
      font-size: 11pt;
    }

    .flex-container {
      display: flex;
      flex-direction: row;
    }

    form {
      margin: 0 auto;
    }

    .listing-table {
      margin: 0 auto;
    }

    th {
      width: 160px;
      text-align: left;
      font-weight: lighter;
    }

    td {
      width: 160px;
      text-align: right;
    }

    legend {
      text-align: center;
      color: grey;
    }

    label {
      color: grey;
      margin-bottom: 0;
    }

    input[type="text"],
    input[type="email"],
    input[type="url"],
    select {
      width: 290px;
      padding: 0.75%;
      margin-bottom: 5px;
      font-size: 14pt;
      border: none;
    }

    .btn-reset select {
      width: 278px;
      background-color: #ebebed;
    }

    .btn-reset {
      border: none;
    }

    input[name='payment'] {
      color: #0000FF;
      font-size: 14pt;
      font-family: 'Courier New', Courier, monospace;
      background-color: #ebebed;
    }

    #initial_payment,
    .product,
    .select-option {
      display: none;
    }

    .logout {
      border: none;
      font-size: 12pt;
      margin-left: 24px;
    }

    .submit {
      width: 25%;
    }

    .select-item {
      width: 290px;
      border: none;
    }

    /* Responsive layout */
    @media (max-width: 800px) {
      .flex-container {
        flex-direction: column;
      }
    }

    footer {
      width: 100%;
      position: fixed;
      bottom: 0;
      font-size: 12pt;
      text-align: center;
    }
  </style>

  <!-- Disable Right Clicking -->
  <script type='text/javascript'>
    document.addEventListener('contextmenu', event => event.preventDefault()); 
  </script>
</head>
<!-- Navbar-->
<nav class="navbar navbar-expand-md bg-light navbar-dark">
  <a class="navbar-brand" href="/">
    <span> Stock Manager </span>
  </a>
  <button class="navbar-toggler" style="color: #0000FF" data-toggle="collapse" data-target="#collapsibleNavbar">
    <i class="fa fa-bars"></i>
  </button>
  <div class="collapse navbar-collapse" id="collapsibleNavbar">
    <!--Links-->
    <ul class="navbar-nav ml-auto">
      <!--Dropdown-->
      <li class="nav-item dropdown">
        <div class="nav-link dropdown-toggle" style="color: #000000" id="navbardrop" data-toggle="dropdown">
          your menu here:
        </div>
        <div class="dropdown-menu">
          <a class="dropdown-item" href="/suppliers/new">New Supplier</a>
          <a class="dropdown-item" href="/suppliers">List Suppliers</a>
          <a class="dropdown-item" href="/customers/new">New Customer</a>
          <a class="dropdown-item" href="/products/search">Search Product</a>
          <a class="dropdown-item" href="/debtors">Invoice</a>
          <a class="dropdown-item" href="/finance-and-investments/new">Finance / Investments</a>
          <form method="POST" action="/logout"><br /><button class="logout" type="submit">
              <div>Logout <i class="fa fa-sign-out" aria-hidden="true"></i></div>
            </button></form>
        </div>
      </li>
    </ul>
  </div>
</nav>

<div class="content">
  <!-- render child views here -->
  {{{body}}}
</div>

<!-- JAVASCRIPT -->
<script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.slim.min.js"
  integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.bundle.min.js"
  integrity="sha384-fQybjgWLrvvRgtW6bFlB7jaZrFsaBXjsOMm/tB9LTS58ONXgqbR9W8oWht/amnpF" crossorigin="anonymous"></script>

<script type="text/javascript">

  const handleInput = () => {

    // Total Cost
    document.getElementById('total_cost').value = Number(document.getElementById('quantity').value) * Number(document.getElementById('unit_cost').value);

    // FORMAT NUMBER AND DISPLAY AS CURRENCY
    var totalCost = new Intl.NumberFormat('en-UG', {
      style: 'currency',
      currency: 'UGX',
      minimumFractionDigits: 2
    });
    document.querySelector('.totalCost').textContent = totalCost.format(document.getElementById('total_cost').value);

    // Insert Product automatically
    document.getElementById('product').value = "{{product.product_name}}";

    // Insert Dates automatically
    document.getElementById('transaction_date').value = Date();
    document.getElementById('updated_on').value = document.getElementById('transaction_date').value;

    // Transactions by User ID
    if (document.getElementById('transaction_type').value == "Purchases")
      document.getElementById('userId').value = "{{product.user_id}}";

    // Unit Cost
    if (document.getElementById('transaction_type').value == "Sales")
      document.getElementById('unit_cost').value = "{{product.retail_price}}";
    if (document.getElementById('transaction_type').value == "Goods Withdrawn")
      document.getElementById('unit_cost').value = "{{product.closing_stock}}" / "{{product.quantity_instock}}";

    // Payment
    if (document.getElementById('transaction_type').value == "Purchases")
      document.getElementById('payment').value = "Issued"

    if (document.getElementById('transaction_type').value == "Sales")
      document.getElementById('payment').value = "Received"

    if (document.getElementById('transaction_type').value == "Goods Withdrawn")
      document.getElementById('payment').value = "None"

    // Creditor, Debtors, Goods Withdrawn
    if (document.getElementById('transaction_type').value == "Purchases")
      document.getElementById('creditor').value = Number(document.getElementById('total_cost').value) - Number(document.getElementById('initial_payment').value);

    if (document.getElementById('transaction_type').value == "Sales")
      document.getElementById('debtor').value = Number(document.getElementById('total_cost').value) - Number(document.getElementById('initial_payment').value);

    if (document.getElementById('transaction_type').value == "Goods Withdrawn")
      document.getElementById('goods_withdrawn').value = Number(document.getElementById('total_cost').value);

    //
    if (document.getElementById('transaction_type').value == "Purchases")
      // Display the field "initial_payment"
      $('#initial_payment').css('display', 'inline');

    if (document.getElementById('transaction_type').value == "Sales")
      // Display the field "initial_payment"
      $('#initial_payment').css('display', 'inline');

    if (document.getElementById('transaction_type').value == "Goods Withdrawn")
      // Hide the field "payment"
      $('#payment').css('display', 'none');

    // FORMAT NUMBER AND DISPLAY AS CURRENCY
    var debt = new Intl.NumberFormat('en-UG', {
      style: 'currency',
      currency: 'UGX',
      minimumFractionDigits: 2
    });
    if (document.getElementById('transaction_type').value == "Purchases")
      document.querySelector('.debt').textContent = debt.format(document.getElementById('creditor').value);
    if (document.getElementById('transaction_type').value == "Sales")
      document.querySelector('.debt').textContent = debt.format(document.getElementById('debtor').value);
    if (document.getElementById('transaction_type').value == "Goods Withdrawn")
      document.querySelector('.debt').textContent = debt.format(document.getElementById('goods_withdrawn').value);
  }

  const handleSubmit = () => {
    // Hide the Transaction Form
    $('.transaction').css('display', 'none');
    // Display the Product Form
    $('.product').css('display', 'inline');
  }

  const handleProductSubmit = () => {
    // Quantity Purchased
    if (document.getElementById('transaction_type').value == "Purchases")
      document.getElementById('quantity_purchased').value = Number(document.getElementById('quantity_purchased').value) + Number(document.getElementById('quantity').value);
    if (document.getElementById('transaction_type').value == "Purchases Returns")
      document.getElementById('quantity_purchased').value = Number(document.getElementById('quantity_purchased').value) - Number(document.getElementById('quantity').value);
    if (document.getElementById('transaction_type').value == "Goods Withdrawn")
      document.getElementById('quantity_purchased').value = Number(document.getElementById('quantity_purchased').value) - Number(document.getElementById('quantity').value);

    // Quantity Sold
    if (document.getElementById('transaction_type').value == "Sales")
      document.getElementById('quantity_sold').value = Number(document.getElementById('quantity_sold').value) + Number(document.getElementById('quantity').value);
    if (document.getElementById('transaction_type').value == "Sales Returns")
      document.getElementById('quantity_sold').value = Number(document.getElementById('quantity_sold').value) - Number(document.getElementById('quantity').value);

    // Quantity Instock
    if ((document.getElementById('transaction_type').value == "Purchases") || (document.getElementById('transaction_type').value == "Sales"))
      document.getElementById('quantity_instock').value = Number(document.getElementById('quantity_purchased').value) - Number(document.getElementById('quantity_sold').value);
    if (document.getElementById('transaction_type').value == "Purchases Returns")
      document.getElementById('quantity_instock').value = Number(document.getElementById('quantity_instock').value) - Number(document.getElementById('quantity').value);
    if (document.getElementById('transaction_type').value == "Sales Returns")
      document.getElementById('quantity_instock').value = Number(document.getElementById('quantity_instock').value);

    // Discontinued
    if (document.getElementById('quantity_instock').value == 0)
      document.getElementById('discontinued').value = 'Yes'
    else
      document.getElementById('discontinued').value = 'No'

    // Purchases
    if (document.getElementById('transaction_type').value == "Purchases")
      document.getElementById('net_purchases').value = Number(document.getElementById('net_purchases').value) + Number(document.getElementById('total_cost').value);
    if (document.getElementById('transaction_type').value == "Purchases Returns")
      document.getElementById('net_purchases').value = Number(document.getElementById('net_purchases').value) - Number(document.getElementById('total_cost').value);
    if (document.getElementById('transaction_type').value == "Goods Withdrawn")
      document.getElementById('net_purchases').value = Number(document.getElementById('net_purchases').value) - Number(document.getElementById('total_cost').value);

    // Sales
    if (document.getElementById('transaction_type').value == "Sales")
      document.getElementById('net_sales').value = Number(document.getElementById('net_sales').value) + Number(document.getElementById('total_cost').value);
    if (document.getElementById('transaction_type').value == "Sales Returns")
      document.getElementById('net_sales').value = Number(document.getElementById('net_sales').value) - Number(document.getElementById('total_cost').value);

    // Closing Stock
    if (document.getElementById('transaction_type').value == "Purchases")
      document.getElementById('closing_stock').value = Number(document.getElementById('closing_stock').value) + Number(document.getElementById('total_cost').value);
    if (document.getElementById('transaction_type').value == "Sales")
      document.getElementById('closing_stock').value = Number(document.getElementById('quantity_instock').value) * Number(document.getElementById('closing_stock').value)
        / (Number(document.getElementById('quantity_instock').value) + Number(document.getElementById('quantity').value));
    if (document.getElementById('transaction_type').value == "Goods Withdrawn")
      document.getElementById('closing_stock').value = Number(document.getElementById('closing_stock').value) - Number(document.getElementById('total_cost').value);

    // Cost of Sales
    document.getElementById('cost_of_sales').value = Number(document.getElementById('net_purchases').value) - Number(document.getElementById('closing_stock').value);

    // Gross Profit
    document.getElementById('gross_profit_or_loss').value = Number(document.getElementById('net_sales').value) - Number(document.getElementById('cost_of_sales').value);
  }

</script>

<footer class="bg-light">
  Copyright &copy; 2022 Mwanika Stephen Crispin
</footer>
<br>

</html>