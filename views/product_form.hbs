<style>
  body {
    /* Padding to prevent the content to go underneath the header */
    padding-top: 75px;
    font-family: Courier;
    background-color: #ebebed;
  }

  .navbar {
    width: 100%;
    position: fixed;
    top: 0;
  }

  span {
    color: black;
    font-size: 18pt;
  }

  .logout {
    color: red;
    font-size: 12pt;
  }

  .flex-container {
    display: flex;
    flex-direction: row;
  }

  form {
    flex: 50%;
    text-align: center;
  }

  /* Responsive layout */
  @media (max-width: 800px) {
    .flex-container {
      flex-direction: column;
    }
  }

  legend,
  label,
  h6 {
    color: orange;
    margin-bottom: 0;
  }

  input[type="text"],
  input[type="date"],
  input[type="email"],
  input[type="url"],
  select {
    width: 290px;
    padding: 0.75%;
    margin-bottom: 5px;
    font-size: 12pt;
    border: 1px solid grey;
  }

  .submit {
    width: 290px;
    border: none;
  }

  .customer,
  .btn-product {
    display: none;
  }

  footer {
    width: 100%;
    position: fixed;
    bottom: 0;
    text-align: center;
  }
</style>

<div class="flex-container">

  <!-- CUSTOMER FORM -->
  <form class="customer" method="POST" action="/customers" oninput="customerName()" onsubmit="customerForm()">
    <fieldset>
      <legend>Customer</legend><br /><label>Customer Name:</label><br /><input id="customer_name" type="text"
        name="customer_name" required /><br /><label>Country:</label><br /><input id="country" type="text"
        name="country" required /><br /><label>City/Town:</label><br /><input id="city" type="text" name="city"
        required /><br /><label>Street:</label><br /><input id="street" type="text" name="street"
        required /><br /><label>Address:</label><br /><input id="address" type="text" name="address"
        required /><br /><label>Telephone:</label><br /><input id="telephone" type="text" name="telephone"
        required /><br /><label>Email:</label><br /><input id="email" type="email" name="email"
        required /><br /><label>Website: </label><br /><input id="website" type="url" name="website" /><br /><button
        class="btn btn-success submit btn-customer" type="submit">Save</button><br />
      <span id="msg"></span>
    </fieldset>
  </form>

  <!-- TRANSACTION FORM -->
  <form class="transaction" method="POST" action="/transactions" oninput="runTransaction()"
    onsubmit="transactionForm()">
    <fieldset>
      <legend>Transaction</legend><br /><label>Transaction Type:</label><br /><select id="transaction_type"
        name="transaction_type">
        <option value="">SELECT...</option>
        <option value="Purchases">PURCHASES</option>
        <option value="Sales">SALES</option>
        <option value="Drawings">DRAWINGS</option>
        <option value="Purchases Returns">PURCHASES RETURNS</option>
        <option value="Sales Returns">SALES RETURNS</option>
      </select><br /><label>Product:</label><br /><input id="product" type="text" name="product"
        readonly /><br /><label>Quantity:</label><br /><input id="quantity" type="text"
        name="quantity" /><br /><label>Unit
        Cost:</label><br /><input id="unit_cost" type="text" name="unit_cost" /><br /><label>Total
        Cost:</label><br /><input id="total_cost" type="text" name="total_cost"
        required /><br /><label>Payment:</label><br /><input id="payment" type="text"
        name="payment" /><br /><label>Amount:</label><br /><input id="amount" type="text" name="amount"
        required /><br /><label>Balance:</label><br /><input id="balance" type="text" name="balance" required /><input
        id="transaction_note" type="hidden" name="transaction_note" /><br /><input id="witness" type="hidden"
        name="witness" readonly /><input id="transaction_date" type="hidden" name="transaction_date"
        value="{{product.transaction_date}}" readonly /><button class="btn btn-success submit btn-transaction"
        type="submit">Save</button><br />
    </fieldset>
  </form>

  <!-- PRODUCT FORM -->
  <form method="POST" action="/products" onsubmit="productForm()">
    <input type="hidden" name="_id" value="{{product._id}}">
    <fieldset>
      <legend>Product</legend><br /><label><input id="supplied_by" type="hidden" name="supplied_by"
          value="{{product.supplied_by}}" readonly /><input id="product_name" type="hidden" name="product_name"
          value="{{product.product_name}}" readonly /><input id="category" type="hidden" name="category"
          value="{{product.category}}" readonly /><label>Retail Price:</label><br /><input id="retail_price" type="text"
          name="retail_price" value="{{product.retail_price}}" /><input id="quantity_purchased" type="hidden"
          name="quantity_purchased" value="{{product.quantity_purchased}}" readonly /><input id="purchases"
          type="hidden" name="purchases" value="{{product.purchases}}" readonly /><input id="quantity_sold"
          type="hidden" name="quantity_sold" value="{{product.quantity_sold}}" readonly /><input id="sales"
          type="hidden" name="sales" value="{{product.sales}}" readonly /><br /><input id="quantity_instock"
          type="hidden" name="quantity_instock" value="{{product.quantity_instock}}" readonly /><input
          id="closing_stock" type="hidden" name="closing_stock" value="{{product.closing_stock}}" readonly /><input
          id="cost_of_sales" type="hidden" name="cost_of_sales" value="{{product.cost_of_sales}}" readonly /><input
          id="gross_profit" type="hidden" name="gross_profit" value="{{product.gross_profit}}"
          readonly /><label>Discontinued:</label><br /><input id="discontinued" type="text" name="discontinued"
          value="{{product.discontinued}}" /><br /><input id="created_at" type="hidden" name="created_at"
          value="{{product.created_at}}" readonly /><input id="updated_at" type="hidden" name="updated_at"
          value="{{product.updated_at}}" readonly /><br /><button class="btn btn-success submit btn-product"
          type="submit">Conclude
          Transaction</button><br />
    </fieldset>
  </form>

</div>

<script type="text/javascript">

  // field witness == field customer_name
  const customerName = () => {
    document.getElementById('witness').value = document.getElementById('customer_name').value;
  }

  // manage transactions
  const runTransaction = () => {
    // insert product automatically
    document.getElementById('product').value = document.getElementById('product_name').value;

    // insert transaction_date automatically
    document.getElementById('transaction_date').value = Date();
    document.getElementById('updated_at').value = document.getElementById('transaction_date').value;

    // payment(issued, received)
    if (document.getElementById('transaction_type').value == "Purchases")
      document.getElementById('payment').value = "Issued"
    if (document.getElementById('transaction_type').value == "Sales")
      document.getElementById('payment').value = "Received"

    // total_cost
    if (document.getElementById('transaction_type').value == "Sales")
      document.getElementById('total_cost').value = Number(document.getElementById('quantity').value) * Number(document.getElementById('unit_cost').value);

    // witness the transaction
    if (document.getElementById('transaction_type').value == "Purchases")
      document.getElementById('witness').value = document.getElementById('supplied_by').value;
    else
      document.getElementById('witness').value = document.getElementById('customer_name').value;

    // unit_cost for transaction
    if (document.getElementById('transaction_type').value == "Sales")
      document.getElementById('unit_cost').value = document.getElementById('retail_price').value;
    else
      document.getElementById('unit_cost').value = document.getElementById('total_cost').value / document.getElementById('quantity').value;

    // balance after payment(issued, received)
    document.getElementById('balance').value = Number(document.getElementById('total_cost').value) - Number(document.getElementById('amount').value);

    // transaction_note 
    if (document.getElementById('balance').value > 0)
      document.getElementById('transaction_note').value = 'credit';
    else
      document.getElementById('transaction_note').value = 'cash';

    //
    if ((document.getElementById('transaction_type').value == "Sales") || (document.getElementById('transaction_type').value == "Sales Returns"))
      // display the form
      $('.customer').css('display', 'inline');

    //
    if ((document.getElementById('transaction_type').value == "Sales") || (document.getElementById('transaction_type').value == "Sales Returns"))
      // hide the form
      $('.transaction').css('display', 'none');

    //
    if (((document.getElementById('transaction_type').value == "Sales") || (document.getElementById('transaction_type').value == "Sales Returns")) && document.getElementById('witness').value != "")
      // hide the form
      $('.customer').css('display', 'none');

    //
    if (((document.getElementById('transaction_type').value == "Sales") || (document.getElementById('transaction_type').value == "Sales Returns")) && document.getElementById('witness').value != "")
      // display the form
      $('.transaction').css('display', 'inline');

    //
    if ((document.getElementById('transaction_type').value == "Purchases") || (document.getElementById('transaction_type').value == "Purchases Returns"))
      // display the form
      $('.transaction').css('display', 'inline');
  }

  const productForm = () => {
    // Purchases and Sales -- quantity(quantity_purchased, quantity_sold)
    if (document.getElementById('transaction_type').value == "Purchases")
      document.getElementById('quantity_purchased').value = Number(document.getElementById('quantity_purchased').value) + Number(document.getElementById('quantity').value);
    if (document.getElementById('transaction_type').value == "Sales")
      document.getElementById('quantity_sold').value = Number(document.getElementById('quantity_sold').value) + Number(document.getElementById('quantity').value);
    if (document.getElementById('transaction_type').value == "Purchases Returns")
      document.getElementById('quantity_purchased').value = Number(document.getElementById('quantity_purchased').value) - Number(document.getElementById('quantity').value);
    if (document.getElementById('transaction_type').value == "Sales Returns")
      document.getElementById('quantity_sold').value = Number(document.getElementById('quantity_sold').value) - Number(document.getElementById('quantity').value);
    if (document.getElementById('transaction_type').value == "Drawings")
      document.getElementById('quantity_purchased').value = Number(document.getElementById('quantity_purchased').value) - Number(document.getElementById('quantity').value);

    // Purchases and Sales -- total value(total_cost)
    if (document.getElementById('transaction_type').value == "Purchases")
      document.getElementById('purchases').value = Number(document.getElementById('purchases').value) + Number(document.getElementById('total_cost').value);
    if (document.getElementById('transaction_type').value == "Sales")
      document.getElementById('sales').value = Number(document.getElementById('sales').value) + Number(document.getElementById('total_cost').value);
    if (document.getElementById('transaction_type').value == "Purchases Returns")
      document.getElementById('purchases').value = Number(document.getElementById('purchases').value) - Number(document.getElementById('total_cost').value);
    if (document.getElementById('transaction_type').value == "Sales Returns")
      document.getElementById('sales').value = Number(document.getElementById('sales').value) - Number(document.getElementById('total_cost').value);

    // Drawings
    if (document.getElementById('transaction_type').value == "Drawings")
      document.getElementById('purchases').value = Number(document.getElementById('purchases').value) - Number(document.getElementById('total_cost').value);
    if (document.getElementById('transaction_type').value == "Drawings")
      document.getElementById('closing_stock').value = Number(document.getElementById('quantity_instock').value) * Number(document.getElementById('closing_stock').value)
        / (Number(document.getElementById('quantity_instock').value) - Number(document.getElementById('quantity').value));

    // Units Instock
    document.getElementById('quantity_instock').value = Number(document.getElementById('quantity_purchased').value) - Number(document.getElementById('quantity_sold').value);

    // Closing Stock
    if (document.getElementById('transaction_type').value == "Purchases")
      document.getElementById('closing_stock').value = Number(document.getElementById('closing_stock').value) + Number(document.getElementById('total_cost').value);
    if (document.getElementById('transaction_type').value == "Sales")
      document.getElementById('closing_stock').value = Number(document.getElementById('quantity_instock').value) * Number(document.getElementById('closing_stock').value)
        / (Number(document.getElementById('quantity_instock').value) + Number(document.getElementById('quantity').value));

    // Cost of Sales
    document.getElementById('cost_of_sales').value = Number(document.getElementById('purchases').value) - Number(document.getElementById('closing_stock').value);

    // Gross Profit
    document.getElementById('gross_profit').value = Number(document.getElementById('sales').value) - Number(document.getElementById('cost_of_sales').value);
  }

  const customerForm = () => {
    // hide the form
    $('.customer').css('display', 'none');
    // display the form
    $('.transaction').css('display', 'inline');
  }

  const transactionForm = () => {
    // hide the button
    $('.btn-transaction').css('display', 'none');
    // display the button
    $('.btn-product').css('display', 'inline');
  }

</script>